<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Estatísticas - Haxball Tactical Board</title>
  <style>
    body {
      margin: 0;
      background: #1b1b1b;
      color: #e5e7eb;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    
    .stats-container {
      max-width: 800px;
      margin: 0 auto;
    }
    
    h1 {
      text-align: center;
      color: #B917FF;
      margin-bottom: 30px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: #2c2c2c;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
    }
    
    .stat-number {
      font-size: 2em;
      font-weight: bold;
      color: #B917FF;
      margin-bottom: 10px;
    }
    
    .stat-label {
      font-size: 14px;
      color: #999;
    }
    
    .chart-container {
      background: #2c2c2c;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
    }
    
    .refresh-btn {
      background: #B917FF;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      margin-bottom: 20px;
    }
    
    .refresh-btn:hover {
      background: #9a15d4;
    }
    
    .loading {
      opacity: 0.5;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div class="stats-container">
    <h1>📊 Estatísticas do Haxball Tactical Board</h1>
    
    <button class="refresh-btn" onclick="loadAllStats()">🔄 Atualizar Estatísticas</button>
    
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number" id="totalVisits">-</div>
        <div class="stat-label">Total de Visitas</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-number" id="todayVisits">-</div>
        <div class="stat-label">Visitas Hoje</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-number" id="downloads">-</div>
        <div class="stat-label">Downloads PNG</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-number" id="drawActivations">-</div>
        <div class="stat-label">Ativações de Desenho</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-number" id="languageChanges">-</div>
        <div class="stat-label">Mudanças de Idioma</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-number" id="discordClicks">-</div>
        <div class="stat-label">Cliques no Discord</div>
      </div>
    </div>
    
    <div class="chart-container">
      <h3>📈 Visitas nos Últimos Dias</h3>
      <canvas id="visitsChart" width="400" height="200"></canvas>
    </div>
    
    <div class="chart-container">
      <h3>🌍 Uso por Idioma</h3>
      <div id="languageStats">
        <div>🇧🇷 Português: <span id="ptCount">-</span></div>
        <div>🇺🇸 English: <span id="enCount">-</span></div>
        <div>🇹🇷 Türkçe: <span id="trCount">-</span></div>
      </div>
    </div>
  </div>

  <script>
    // Configuração das APIs
    const BASE_URL = 'https://api.countapi.xyz';
    const SITE_KEY = 'haxballboard.netlify.app';
    
    const COUNTERS = {
      total: 'total-visits',
      today: 'visits-' + new Date().toISOString().split('T')[0],
      downloads: 'png-downloads',
      drawActivations: 'draw-activations',
      languageChanges: 'language-changes',
      discordClicks: 'discord-clicks',
      portuguese: 'lang-pt',
      english: 'lang-en',
      turkish: 'lang-tr'
    };

    // Função para buscar dados de um contador
    async function getCounterData(counterKey) {
      try {
        const response = await fetch(`${BASE_URL}/get/${SITE_KEY}/${counterKey}`);
        const data = await response.json();
        return data.value || 0;
      } catch (error) {
        console.error(`Erro ao buscar ${counterKey}:`, error);
        return 0;
      }
    }

    // Função para incrementar um contador
    async function incrementCounter(counterKey) {
      try {
        const response = await fetch(`${BASE_URL}/hit/${SITE_KEY}/${counterKey}`);
        const data = await response.json();
        return data.value || 0;
      } catch (error) {
        console.error(`Erro ao incrementar ${counterKey}:`, error);
        return 0;
      }
    }

    // Carregar todas as estatísticas
    async function loadAllStats() {
      const container = document.querySelector('.stats-container');
      container.classList.add('loading');
      
      try {
        // Carregar dados básicos
        const [total, today, downloads, draws, langChanges, discord, pt, en, tr] = await Promise.all([
          getCounterData(COUNTERS.total),
          getCounterData(COUNTERS.today),
          getCounterData(COUNTERS.downloads),
          getCounterData(COUNTERS.drawActivations),
          getCounterData(COUNTERS.languageChanges),
          getCounterData(COUNTERS.discordClicks),
          getCounterData(COUNTERS.portuguese),
          getCounterData(COUNTERS.english),
          getCounterData(COUNTERS.turkish)
        ]);

        // Atualizar interface
        document.getElementById('totalVisits').textContent = total.toLocaleString();
        document.getElementById('todayVisits').textContent = today.toLocaleString();
        document.getElementById('downloads').textContent = downloads.toLocaleString();
        document.getElementById('drawActivations').textContent = draws.toLocaleString();
        document.getElementById('languageChanges').textContent = langChanges.toLocaleString();
        document.getElementById('discordClicks').textContent = discord.toLocaleString();
        
        // Estatísticas por idioma
        document.getElementById('ptCount').textContent = pt.toLocaleString();
        document.getElementById('enCount').textContent = en.toLocaleString();
        document.getElementById('trCount').textContent = tr.toLocaleString();
        
        // Criar gráfico simples de visitas (últimos 7 dias)
        await createVisitsChart();
        
      } catch (error) {
        console.error('Erro ao carregar estatísticas:', error);
      } finally {
        container.classList.remove('loading');
      }
    }

    // Criar gráfico simples de visitas
    async function createVisitsChart() {
      const canvas = document.getElementById('visitsChart');
      const ctx = canvas.getContext('2d');
      
      // Buscar dados dos últimos 7 dias
      const dates = [];
      const visits = [];
      
      for (let i = 6; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        const dateStr = date.toISOString().split('T')[0];
        const dayVisits = await getCounterData(`visits-${dateStr}`);
        
        dates.push(date.getDate() + '/' + (date.getMonth() + 1));
        visits.push(dayVisits);
      }
      
      // Desenhar gráfico simples
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.strokeStyle = '#B917FF';
      ctx.fillStyle = '#B917FF';
      ctx.lineWidth = 2;
      
      const maxVisits = Math.max(...visits) || 1;
      const padding = 40;
      const chartWidth = canvas.width - padding * 2;
      const chartHeight = canvas.height - padding * 2;
      
      // Desenhar linha
      ctx.beginPath();
      visits.forEach((visit, index) => {
        const x = padding + (index * chartWidth) / (visits.length - 1);
        const y = padding + chartHeight - (visit / maxVisits) * chartHeight;
        
        if (index === 0) {
          ctx.moveTo(x, y);
        } else {
          ctx.lineTo(x, y);
        }
      });
      ctx.stroke();
      
      // Desenhar pontos e labels
      ctx.fillStyle = '#e5e7eb';
      ctx.font = '12px Arial';
      ctx.textAlign = 'center';
      
      visits.forEach((visit, index) => {
        const x = padding + (index * chartWidth) / (visits.length - 1);
        const y = padding + chartHeight - (visit / maxVisits) * chartHeight;
        
        // Ponto
        ctx.fillStyle = '#B917FF';
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, 2 * Math.PI);
        ctx.fill();
        
        // Data
        ctx.fillStyle = '#e5e7eb';
        ctx.fillText(dates[index], x, canvas.height - 10);
        
        // Valor
        if (visit > 0) {
          ctx.fillText(visit.toString(), x, y - 10);
        }
      });
    }

    // Funções para rastrear eventos específicos (use no seu site principal)
    window.trackVisit = () => incrementCounter(COUNTERS.total);
    window.trackTodayVisit = () => incrementCounter(COUNTERS.today);
    window.trackDownload = () => incrementCounter(COUNTERS.downloads);
    window.trackDrawActivation = () => incrementCounter(COUNTERS.drawActivations);
    window.trackLanguageChange = (lang) => {
      incrementCounter(COUNTERS.languageChanges);
      incrementCounter(COUNTERS[lang === 'pt' ? 'portuguese' : lang === 'en' ? 'english' : 'turkish']);
    };
    window.trackDiscordClick = () => incrementCounter(COUNTERS.discordClicks);

    // Carregar estatísticas ao abrir a página
    document.addEventListener('DOMContentLoaded', loadAllStats);
  </script>
</body>
</html>
