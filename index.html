<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Estatísticas - Haxball Tactical Board</title>
  <style>
    body {
      margin: 0;
      background: #1b1b1b;
      color: #e5e7eb;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    
    .stats-container { max-width: 800px; margin: 0 auto; }
    h1 { text-align: center; color: #B917FF; margin-bottom: 30px; }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .stat-card { background: #2c2c2c; border: 1px solid #444; border-radius: 8px; padding: 20px; text-align: center; }
    .stat-number { font-size: 2em; font-weight: bold; color: #B917FF; margin-bottom: 10px; }
    .stat-label { font-size: 14px; color: #999; }
    .chart-container { background: #2c2c2c; border: 1px solid #444; border-radius: 8px; padding: 20px; margin-top: 20px; }
    .refresh-btn { background: #B917FF; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin-bottom: 20px; }
    .refresh-btn:hover { background: #9a15d4; }
    .loading { opacity: 0.5; pointer-events: none; }
  </style>
</head>
<body>
  <div class="stats-container">
    <h1>📊 Estatísticas do Haxball Tactical Board</h1>
    <button class="refresh-btn" onclick="loadAllStats()">🔄 Atualizar Estatísticas</button>
    
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number" id="totalVisits">-</div>
        <div class="stat-label">Total de Visitas</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="todayVisits">-</div>
        <div class="stat-label">Visitas Hoje</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="downloads">-</div>
        <div class="stat-label">Downloads PNG</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="drawActivations">-</div>
        <div class="stat-label">Ativações de Desenho</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="languageChanges">-</div>
        <div class="stat-label">Mudanças de Idioma</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="discordClicks">-</div>
        <div class="stat-label">Cliques no Discord</div>
      </div>
    </div>
    
    <div class="chart-container">
      <h3>📈 Visitas nos Últimos Dias</h3>
      <canvas id="visitsChart" width="400" height="200"></canvas>
    </div>
    
    <div class="chart-container">
      <h3>🌍 Uso por Idioma</h3>
      <div id="languageStats">
        <div>🇧🇷 Português: <span id="ptCount">-</span></div>
        <div>🇺🇸 English: <span id="enCount">-</span></div>
        <div>🇹🇷 Türkçe: <span id="trCount">-</span></div>
      </div>
    </div>
  </div>

  <script>
    const BASE_URL = 'https://api.countapi.xyz';

    const COUNTERS = {
      total: 'haxball-board-total-visits',
      today: 'haxball-board-today-visits-' + new Date().toISOString().split('T')[0],
      downloads: 'haxball-board-png-downloads',
      drawActivations: 'haxball-board-draw-activations',
      languageChanges: 'haxball-board-language-changes',
      discordClicks: 'haxball-board-discord-clicks',
      pt: 'haxball-board-lang-pt',
      en: 'haxball-board-lang-en',
      tr: 'haxball-board-lang-tr'
    };

    async function getCounter(counter) {
      try {
        const res = await fetch(`${BASE_URL}/get/${counter}`);
        const data = await res.json();
        return data.value || 0;
      } catch {
        return 0;
      }
    }

    async function incrementCounter(counter) {
      try {
        const res = await fetch(`${BASE_URL}/hit/${counter}`);
        const data = await res.json();
        return data.value || 0;
      } catch {
        return 0;
      }
    }

    async function loadAllStats() {
      const container = document.querySelector('.stats-container');
      container.classList.add('loading');

      try {
        const [total, today, downloads, draw, langChange, discord, pt, en, tr] = await Promise.all([
          getCounter(COUNTERS.total),
          getCounter(COUNTERS.today),
          getCounter(COUNTERS.downloads),
          getCounter(COUNTERS.drawActivations),
          getCounter(COUNTERS.languageChanges),
          getCounter(COUNTERS.discordClicks),
          getCounter(COUNTERS.pt),
          getCounter(COUNTERS.en),
          getCounter(COUNTERS.tr)
        ]);

        document.getElementById('totalVisits').textContent = total.toLocaleString();
        document.getElementById('todayVisits').textContent = today.toLocaleString();
        document.getElementById('downloads').textContent = downloads.toLocaleString();
        document.getElementById('drawActivations').textContent = draw.toLocaleString();
        document.getElementById('languageChanges').textContent = langChange.toLocaleString();
        document.getElementById('discordClicks').textContent = discord.toLocaleString();
        document.getElementById('ptCount').textContent = pt.toLocaleString();
        document.getElementById('enCount').textContent = en.toLocaleString();
        document.getElementById('trCount').textContent = tr.toLocaleString();

      } finally {
        container.classList.remove('loading');
      }
    }

    // Incrementa contadores ao abrir página
    document.addEventListener('DOMContentLoaded', async () => {
      await incrementCounter(COUNTERS.total);
      await incrementCounter(COUNTERS.today);
      loadAllStats();
    });
  </script>
</body>
</html>
